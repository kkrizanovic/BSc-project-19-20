#include <gtest/gtest.h>

#include <iostream>
#include <minimizers/minimizers.hpp>
#include <vector>

// clang-format off

#define VECTOR_OF_KMERS(var, ...) \
  ::std::vector<::blue::KMerInfo> var{__VA_ARGS__};

#define BLOAT(seq, k, w, ...)            \
  VECTOR_OF_KMERS(name, __VA_ARGS__)     \
  auto kmers = minimizers(               \
    seq,                                 \
    SequenceLength{sizeof(seq) - 1},     \
    KType{k},                            \
    WindowLength{w});                    \
  ASSERT_EQ(name.size(), kmers.size());  \
  for (auto i = 0; i < name.size(); ++i) \
    ASSERT_EQ(name[i], kmers[i]);

// clang-format on

namespace blue {
namespace {

TEST(MinimizerTest, Test8) {
  BLOAT("ACCTGCAC", 3, 2, {16, 0, 0}, {2, 1, 0}, {7, 3, 1}, {4, 5, 0});
}

TEST(MinimizerTests, Test37) {
  BLOAT("AGCTGCGATGCTAGGGCTATTCTCTATCGGATCGATG", 5, 15, {99, 0, 1}, {54, 7, 1},
        {9, 21, 1}, {39, 22, 1}, {99, 27, 1}, {114, 32, 1});
}

TEST(MinimierTests, Test64) {
  BLOAT("ACTGGCGCGCGATGCTAGTCGACGGATCGGGATCGATGCTAGCTGAGGCTAGCTGGACTGAGCT", 8,
        10, {19404, 0, 0}, {12083, 1, 0}, {8672, 2, 1}, {7687, 4, 1},
        {1831, 8, 1}, {2162, 16, 1}, {6360, 26, 1}, {864, 33, 1}, {3459, 34, 1},
        {3636, 39, 1}, {10008, 46, 1}, {6348, 50, 1}, {12107, 52, 0},
        {13063, 55, 1}, {19314, 56, 0});
}

TEST(MinimizerTest, Test200) {
  BLOAT(
      "AGGTCAAGTTCTCGACCTTCTCGTGGGAGGTGATCCAGTTCACTATAGGACCATTCCATTCGAGCATGGCAC"
      "TAAGTACGCCGTCCCCATTCTGGTAATCATCATCCCTATCAGGGTTTGGAGTGAGTGGTGACGGTTATTCCC"
      "CAGGAATGGACTTCTTATTCACAGTCGGTCACATTGGGCTACTCCTTGGGTCTTCC",
      5, 15, {504, 0, 0}, {372, 2, 1}, {94, 4, 0}, {5, 6, 1}, {5, 18, 1},
      {22, 19, 1}, {30, 34, 0}, {26, 47, 1}, {26, 50, 0}, {26, 55, 0},
      {18, 70, 1}, {1, 84, 0}, {6, 85, 0}, {26, 86, 0}, {97, 99, 0},
      {96, 102, 0}, {9, 105, 0}, {38, 106, 0}, {127, 111, 0}, {167, 124, 1},
      {27, 131, 1}, {1, 141, 0}, {7, 142, 0}, {31, 143, 0}, {38, 151, 1},
      {71, 163, 0}, {66, 168, 1}, {32, 170, 1}, {4, 173, 1}, {19, 174, 1},
      {43, 187, 0}, {160, 195, 0});
}

TEST(MinimizerTest, Test1000_A) {
  BLOAT(
      "GCTTGGCCCGGTCTGTTGGGCCGCCATTGCGTGAGTTTCGGCCCTGTGCTGCGCTGTGTCGGCGATTCTCAT"
      "TGGGGCCTCACATCTGGAAACCCCGACCTATTTTGACGGCACCATTGGCGGAAGTTGCTGGGCTTGTGCACC"
      "GTGAAGTCCTCCGCGGGCCTCCCCCCTACAAAAGACGATAAGCTCCGGCAAGCAGCATTGATCAACGCAAGG"
      "ATCGGCGATATTAACAGAGATACGGCTGATTACTCTTGTTGGTGTGGTATCGCTAAACTGCGCCGCGGAGCC"
      "TTATGGCAAAGTCGTCCGCGAACCATTCCGGTAGCGCTTAAGGTCCATAGCACATTCATCGCATCCCGGCGT"
      "GCGTTCAATTTGACGACCCCTTGGCGCAAAGGTGCTGGCCACGTGCTAAATTAAAGCGGCTGCACTGCTGTA"
      "AGGTCCGTTACGGAGAGGGCGGCCTGGGGAGAGCACTAGCCCATCGACCTGTACAGGAACACTCTATATTGT"
      "TCTCGGACGGACAGATTACTAGAGTGCCGCTTTCAGCCCCCCTGTCGTCGCCGACGTCTGTAATATGGCGTT"
      "GTTGTGATTCCACTCTATTGAGGCATTAACTGATGCGTAAGGAGATCTGGAATGAACTGGCCTATGTCACTG"
      "AAACTGTGCAAACACCCAATGTCGTTAGTGTAGGTTCTGACCGATACCTGCTTCGTTGAGAACTCACAATTT"
      "TACAACTGGGGACATAATCCCTACGCCCATCATCTACTCGCGTCCCTGTGGCTCCAGTTCATGTAATGGGAG"
      "AGTATCCTCCACAAGATCTAGTGCTATGGTGGTATAGTAAGCTCGTACTGTGGTAGACGCGACACGGGTAGG"
      "ACCATCAGTAATAAGGATAGTGCGAAAGCTCACAGACCACTGCCTATAGGGGGTGCTTACTTTTACAAAAAG"
      "CGACTGTCAGTATAACCCCACGAGGATTCGAAAAGGTGAACCGACCCAGACGATCCGGAGGCAC",
      13, 60, {53199096, 0, 0}, {11469794, 1, 0}, {2160184, 3, 1},
      {1018799, 6, 0}, {766668, 41, 0}, {39409, 83, 1}, {157639, 84, 1},
      {213610, 92, 0}, {854442, 93, 0}, {975672, 140, 1}, {9301, 164, 0},
      {37207, 165, 0}, {148829, 166, 0}, {430517, 210, 1}, {125845, 269, 1},
      {503381, 270, 1}, {1707932, 310, 0}, {1688680, 332, 0}, {998202, 352, 0},
      {179397, 376, 0}, {717589, 377, 0}, {1290838, 398, 0}, {1680500, 428, 1},
      {406574, 471, 0}, {1626297, 472, 0}, {3033044, 479, 0}, {127168, 539, 1},
      {11832, 540, 0}, {47331, 541, 0}, {189324, 542, 0}, {557972, 549, 1},
      {1189559, 585, 0}, {1572408, 616, 1}, {375017, 662, 0}, {1500071, 663, 0},
      {1670275, 706, 1}, {1115415, 737, 1}, {602136, 738, 0}, {399506, 745, 0},
      {769153, 763, 0}, {1144359, 800, 0}, {849874, 839, 1}, {464032, 866, 1},
      {93654, 923, 1}, {79834, 951, 0}, {319336, 952, 0}, {335119, 980, 1},
      {1340479, 981, 1}, {5361916, 982, 1}, {7618309, 985, 1},
      {14171633, 986, 0}, {54784092, 987, 1});
}

TEST(MinimizerTest, Test1000_B) {
  BLOAT(
      "GCTTGGCCCGGTCTGTTGGGCCGCCATTGCGTGAGTTTCGGCCCTGTGCTGCGCTGTGTCGGCGATTCTCAT"
      "TGGGGCCTCACATCTGGAAACCCCGACCTATTTTGACGGCACCATTGGCGGAAGTTGCTGGGCTTGTGCACC"
      "GTGAAGTCCTCCGCGGGCCTCCCCCCTACAAAAGACGATAAGCTCCGGCAAGCAGCATTGATCAACGCAAGG"
      "ATCGGCGATATTAACAGAGATACGGCTGATTACTCTTGTTGGTGTGGTATCGCTAAACTGCGCCGCGGAGCC"
      "TTATGGCAAAGTCGTCCGCGAACCATTCCGGTAGCGCTTAAGGTCCATAGCACATTCATCGCATCCCGGCGT"
      "GCGTTCAATTTGACGACCCCTTGGCGCAAAGGTGCTGGCCACGTGCTAAATTAAAGCGGCTGCACTGCTGTA"
      "AGGTCCGTTACGGAGAGGGCGGCCTGGGGAGAGCACTAGCCCATCGACCTGTACAGGAACACTCTATATTGT"
      "TCTCGGACGGACAGATTACTAGAGTGCCGCTTTCAGCCCCCCTGTCGTCGCCGACGTCTGTAATATGGCGTT"
      "GTTGTGATTCCACTCTATTGAGGCATTAACTGATGCGTAAGGAGATCTGGAATGAACTGGCCTATGTCACTG"
      "AAACTGTGCAAACACCCAATGTCGTTAGTGTAGGTTCTGACCGATACCTGCTTCGTTGAGAACTCACAATTT"
      "TACAACTGGGGACATAATCCCTACGCCCATCATCTACTCGCGTCCCTGTGGCTCCAGTTCATGTAATGGGAG"
      "AGTATCCTCCACAAGATCTAGTGCTATGGTGGTATAGTAAGCTCGTACTGTGGTAGACGCGACACGGGTAGG"
      "ACCATCAGTAATAAGGATAGTGCGAAAGCTCACAGACCACTGCCTATAGGGGGTGCTTACTTTTACAAAAAG"
      "CGACTGTCAGTATAACCCCACGAGGATTCGAAAAGGTGAACCGACCCAGACGATCCGGAGGCAC",
      13, 10, {53199096, 0, 0}, {11469794, 1, 0}, {2160184, 3, 1},
      {1018799, 6, 0}, {4075199, 7, 0}, {12254256, 12, 0}, {3173179, 20, 0},
      {1756894, 23, 0}, {2788704, 28, 1}, {11154818, 29, 1}, {2342889, 39, 1},
      {766668, 41, 0}, {3066674, 42, 0}, {11742947, 48, 0}, {7916203, 58, 1},
      {8830914, 67, 0}, {7076897, 69, 0}, {2169021, 77, 0}, {39409, 83, 1},
      {157639, 84, 1}, {213610, 92, 0}, {854442, 93, 0}, {2534223, 98, 0},
      {10136892, 99, 0}, {11060376, 108, 1}, {4304701, 111, 0},
      {1766359, 113, 0}, {2729142, 120, 1}, {10916571, 121, 1},
      {11991076, 128, 1}, {11453499, 134, 0}, {2363107, 136, 1},
      {975672, 140, 1}, {3890696, 142, 0}, {2150338, 151, 0}, {1172700, 155, 1},
      {9301, 164, 0}, {37207, 165, 0}, {148829, 166, 0}, {595316, 167, 0},
      {1074962, 176, 1}, {1688733, 179, 1}, {3955825, 188, 0},
      {6058413, 192, 0}, {7037260, 199, 0}, {5445592, 206, 0}, {430517, 210, 1},
      {1722068, 211, 1}, {6888274, 212, 1}, {7162844, 217, 1},
      {12435743, 223, 1}, {1178931, 229, 1}, {4715725, 230, 1},
      {8342750, 232, 1}, {11964971, 241, 0}, {9104366, 248, 0},
      {11452143, 250, 0}, {15201947, 255, 1}, {25990444, 264, 0},
      {13193932, 266, 0}, {9776323, 268, 0}, {125845, 269, 1}, {503381, 270, 1},
      {2013526, 271, 1}, {3398697, 278, 0}, {2735191, 286, 0},
      {5463166, 294, 1}, {3362920, 303, 0}, {1707932, 310, 0},
      {2378061, 318, 1}, {4803866, 322, 1}, {1688680, 332, 0},
      {4621873, 338, 0}, {4696187, 344, 1}, {998202, 352, 0}, {3992808, 353, 0},
      {6799848, 358, 1}, {2000513, 364, 1}, {1935401, 374, 1}, {179397, 376, 0},
      {717589, 377, 0}, {2699655, 382, 1}, {5762236, 386, 0}, {6416748, 389, 1},
      {1290838, 398, 0}, {2189179, 401, 1}, {5889781, 404, 1},
      {9807219, 405, 0}, {22697788, 407, 0}, {15910066, 416, 0},
      {4527297, 418, 1}, {1680500, 428, 1}, {3821431, 436, 0},
      {13846527, 446, 1}, {13762546, 449, 1}, {8387765, 452, 1},
      {3143537, 454, 0}, {11891652, 460, 1}, {4833379, 465, 0},
      {4759128, 470, 1}, {406574, 471, 0}, {1626297, 472, 0}, {3033044, 479, 0},
      {3684177, 486, 1}, {3625318, 490, 1}, {4757934, 491, 0},
      {5873134, 497, 1}, {9391943, 505, 0}, {3033059, 511, 1},
      {7770743, 515, 0}, {8271612, 517, 1}, {10349618, 522, 0},
      {3318208, 530, 0}, {127168, 539, 1}, {11832, 540, 0}, {47331, 541, 0},
      {189324, 542, 0}, {557972, 549, 1}, {2231891, 550, 1}, {3465957, 554, 0},
      {3755842, 555, 1}, {2694267, 565, 1}, {7466096, 570, 1},
      {7391894, 578, 1}, {3319209, 581, 1}, {1189559, 585, 0},
      {4758239, 586, 0}, {5173361, 595, 1}, {1852076, 602, 1},
      {2804759, 608, 1}, {1572408, 616, 1}, {6289633, 617, 1},
      {12414283, 622, 0}, {5682481, 628, 1}, {2548013, 636, 0},
      {4156635, 643, 1}, {11881393, 645, 0}, {12260624, 651, 0},
      {5521499, 656, 0}, {4217742, 660, 0}, {375017, 662, 0}, {1500071, 663, 0},
      {2716452, 669, 1}, {9500094, 678, 1}, {4026275, 681, 1},
      {3556042, 688, 0}, {2925485, 694, 0}, {10726868, 698, 0},
      {1670275, 706, 1}, {3394682, 716, 1}, {5439302, 722, 0},
      {6652051, 732, 0}, {1115415, 737, 1}, {602136, 738, 0}, {399506, 745, 0},
      {1598024, 746, 0}, {6392099, 747, 0}, {6441166, 750, 0},
      {3770554, 759, 1}, {769153, 763, 0}, {2000613, 773, 0}, {3541710, 779, 1},
      {2833112, 784, 1}, {11332449, 785, 1}, {15425900, 789, 1},
      {5975212, 796, 1}, {2115032, 797, 0}, {1144359, 800, 0},
      {4049507, 808, 1}, {10219417, 815, 0}, {11200511, 822, 1},
      {24262958, 830, 0}, {9325502, 833, 0}, {849874, 839, 1},
      {3399498, 840, 1}, {10567364, 850, 1}, {5222679, 853, 1},
      {4571249, 860, 1}, {1603941, 865, 0}, {464032, 866, 1}, {1856131, 867, 1},
      {3169260, 877, 1}, {1506062, 880, 1}, {3691935, 889, 1},
      {4669740, 894, 0}, {1229415, 900, 0}, {2523131, 906, 0},
      {1948540, 911, 1}, {7794160, 912, 1}, {10791493, 919, 0}, {93654, 923, 1},
      {374616, 924, 1}, {1498467, 925, 1}, {5600075, 929, 0}, {3426097, 938, 1},
      {4665796, 942, 1}, {79834, 951, 0}, {319336, 952, 0}, {1277347, 953, 0},
      {3491916, 959, 1}, {5004239, 967, 1}, {3409741, 976, 0}, {335119, 980, 1},
      {1340479, 981, 1}, {5361916, 982, 1}, {7618309, 985, 1},
      {14171633, 986, 0}, {54784092, 987, 1});
}

}  // namespace
}  // namespace blue

int main(int argc, char** argv) {
  ::testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}